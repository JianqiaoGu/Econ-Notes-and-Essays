<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Public Writings · Jianqiao Gu</title>
  <meta name="description" content="Essays and notes by Jianqiao Gu." />
  <style>
    :root{
      --bg:#f7f7f8; --card:#ffffff; --text:#1f1f1f; --muted:#6b6b6b; --border:#e6e6e9; --link:#1f2a44;
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; color:var(--text); background:var(--bg)}
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}
    .container{max-width:980px; margin:0 auto; padding:20px}
    header{position:sticky; top:0; z-index:10; background:rgba(255,255,255,.9); backdrop-filter:blur(6px); border-bottom:1px solid var(--border)}
    nav{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:12px 0}
    .brand{font-weight:700}
    .navlinks{display:flex; gap:10px; flex-wrap:wrap}
    .pill{display:inline-block; padding:8px 12px; border:1px solid var(--border); border-radius:999px; background:#fff}
    .pill:hover{background:#f2f3f5}
    .hero{margin:18px 0}
    .muted{color:var(--muted)}
    .controls{display:grid; grid-template-columns:1fr 200px; gap:10px}
    input,select{padding:10px 12px; border:1px solid var(--border); border-radius:12px; background:#fff; color:var(--text)}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:18px; box-shadow:0 6px 18px rgba(0,0,0,.04)}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    .cover{width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:12px; border:1px solid var(--border)}
    .line3{display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden}
    /* Drawer */
    .drawer-mask{position:fixed; inset:0; background:rgba(0,0,0,.3); display:none}
    .drawer{position:fixed; right:0; top:0; height:100%; width:100%; max-width:680px; background:#fff; border-left:1px solid var(--border); display:flex; flex-direction:column; transform:translateX(100%); transition:transform .25s ease}
    .drawer.open + .drawer-mask{display:block}
    .drawer.open{transform:none}
    .drawer-header{display:flex; gap:10px; align-items:center; border-bottom:1px solid var(--border); padding:12px 16px}
    .btn{padding:8px 12px; border:1px solid var(--border); border-radius:10px; background:#fff}
    .btn:hover{background:#f2f3f5}
    .drawer-body{padding:18px 16px; overflow:auto}
    .tags{display:flex; gap:8px; flex-wrap:wrap}
    .tag{padding:6px 10px; border:1px solid var(--border); border-radius:999px; font-size:12px; background:#f7f7f8}
    .pager{display:flex; align-items:center; justify-content:space-between; margin:18px 0}
    @media (max-width:760px){ .grid{grid-template-columns:1fr} .controls{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="brand">Jianqiao Gu</div>
        <div class="navlinks">
          <a class="pill" href="https://jianqiaogu.github.io/">Home</a>
          <a class="pill" href="https://github.com/JianqiaoGu/Econ-Notes-and-Essays">GitHub</a>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="hero card">
      <h1 style="margin:0 0 6px 0">Public Writings</h1>
      <p class="muted" style="margin:0 0 12px 0">Light, WeChat-style reading. Start simple; we can refine later.</p>
      <div class="controls">
        <input id="search" placeholder="Search title or text" />
        <select id="sort">
          <option value="date-desc">Newest</option>
          <option value="date-asc">Oldest</option>
          <option value="title-asc">Title A→Z</option>
          <option value="title-desc">Title Z→A</option>
        </select>
      </div>
      <div id="tagBar" style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap"></div>
    </section>

    <section id="feed" class="grid" style="margin-top:16px"></section>

    <div id="pager" class="pager" style="display:none">
      <button id="prevBtn" class="btn">Prev</button>
      <div id="pageInfo" class="muted"></div>
      <button id="nextBtn" class="btn">Next</button>
    </div>
  </main>

  <!-- Drawer -->
  <div id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer-header">
      <button class="btn" onclick="UI.close()">Close</button>
      <div id="meta" class="muted" style="font-size:14px"></div>
    </div>
    <div class="drawer-body">
      <h2 id="title" style="margin:0 0 8px 0"></h2>
      <div id="tags" class="tags" style="margin:0 0 10px 0"></div>
      <div id="cover"></div>
      <div id="body" style="line-height:1.85; font-size:17px"></div>
      <div id="nav" style="margin-top:16px"></div>
    </div>
  </div>
  <div id="mask" class="drawer-mask" onclick="UI.close()"></div>

  <script>
  // Minimal post data for now. Add 4–5 pieces here first; later we scale up.
  // For big scale, move content to Markdown files and add mdUrl fields.
  const POSTS = [
    {
      id: "2025-11-08-social-mobility",
      title: "Social Mobility and Structural Lock-in",
      date: "2025-11-08",
      tags: ["inequality","mobility","CSI"],
      cover: "",
      content: "A short intro paragraph. Replace with your text. We will refine formatting later."
    },
    {
      id: "2025-10-25-education-trap",
      title: "The Invisible Education Trap",
      date: "2025-10-25",
      tags: ["education","human capital"],
      cover: "",
      content: "Another short paragraph. Add your translated piece here."
    }
  ];

  const State = {q:"", tag:"All", sort:"date-desc", page:1, per:12, filtered:[]};

  const fmtDate = iso => new Date(iso+"T00:00:00").toLocaleDateString(undefined,{year:"numeric",month:"short",day:"numeric"});
  const readMin = s => Math.max(1, Math.round((s||"").split(/\s+/).filter(Boolean).length/240));
  const uniq = a => Array.from(new Set(a));

  const UI = {
    init(){
      document.getElementById("search").addEventListener("input", e => { State.q=e.target.value.trim().toLowerCase(); State.page=1; UI.refresh(); });
      document.getElementById("sort").addEventListener("change", e => { State.sort=e.target.value; State.page=1; UI.refresh(); });
      UI.buildTags();
      UI.refresh();
    },
    buildTags(){
      const tags = ["All", ...uniq(POSTS.flatMap(p=>p.tags||[]))];
      const wrap = document.getElementById("tagBar");
      wrap.innerHTML = "";
      tags.forEach(t=>{
        const b=document.createElement("button");
        b.className="pill";
        b.textContent=t;
        if (t===State.tag) b.style.background="#eef0f3";
        b.onclick=()=>{ State.tag=t; State.page=1; UI.refresh(); };
        wrap.appendChild(b);
      });
    },
    refresh(){
      let list = [...POSTS];
      if (State.tag!=="All") list = list.filter(p => (p.tags||[]).includes(State.tag));
      if (State.q) list = list.filter(p => p.title.toLowerCase().includes(State.q) || (p.content||"").toLowerCase().includes(State.q));
      list.sort((a,b)=>{
        switch(State.sort){
          case "date-asc": return a.date.localeCompare(b.date);
          case "title-asc": return a.title.localeCompare(b.title);
          case "title-desc": return b.title.localeCompare(a.title);
          default: return b.date.localeCompare(a.date);
        }
      });
      State.filtered = list;
      UI.page();
    },
    page(){
      const feed = document.getElementById("feed");
      const pager = document.getElementById("pager");
      const total = State.filtered.length;
      const pages = Math.max(1, Math.ceil(total/State.per));
      State.page = Math.min(Math.max(1, State.page), pages);
      const start = (State.page-1)*State.per;
      const rows = State.filtered.slice(start, start+State.per);
      feed.innerHTML = "";
      rows.forEach((p,i)=>{
        const card=document.createElement("article");
        card.className="card";
        card.innerHTML = `
          ${p.cover ? `<img class="cover" src="${p.cover}" alt="cover">` : ""}
          <div class="muted" style="font-size:12px">${fmtDate(p.date)} · ${readMin(p.content)} min read</div>
          <h3 style="margin:6px 0 6px 0">${p.title}</h3>
          <div class="muted line3">${(p.content||"").slice(0,220)}...</div>
          <div style="margin-top:10px; display:flex; gap:6px; flex-wrap:wrap">
            ${(p.tags||[]).map(t=>`<span class="tag">#${t}</span>`).join("")}
          </div>
          <div style="margin-top:12px"><button class="btn" data-i="${start+i}">Read</button></div>
        `;
        card.querySelector("button").onclick = () => UI.open(start+i);
        feed.appendChild(card);
      });
      if (pages>1){
        pager.style.display="flex";
        document.getElementById("pageInfo").textContent = `Page ${State.page} / ${pages}`;
        document.getElementById("prevBtn").onclick = ()=>{ if(State.page>1){ State.page--; UI.page(); } };
        document.getElementById("nextBtn").onclick = ()=>{ if(State.page<pages){ State.page++; UI.page(); } };
      } else pager.style.display="none";
    },
    open(idx){
      const p = State.filtered[idx];
      document.getElementById("title").textContent = p.title;
      document.getElementById("meta").textContent = `${fmtDate(p.date)} · ${readMin(p.content)} min read`;
      document.getElementById("tags").innerHTML = (p.tags||[]).map(t=>`<span class="tag">#${t}</span>`).join("");
      document.getElementById("cover").innerHTML = p.cover ? `<img class="cover" src="${p.cover}" alt="cover">` : "";
      document.getElementById("body").innerHTML = (p.content||"").replace(/\n/g,"<br>");
      document.getElementById("drawer").classList.add("open");
      document.getElementById("mask").style.display="block";
    },
    close(){
      document.getElementById("drawer").classList.remove("open");
      document.getElementById("mask").style.display="none";
    }
  };
  window.addEventListener("DOMContentLoaded", UI.init);
  </script>
</body>
</html>
